<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="学习总结 思想感悟">
<meta property="og:type" content="website">
<meta property="og:title" content="Skye&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Skye&#39;s Blog">
<meta property="og:description" content="学习总结 思想感悟">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Skye&#39;s Blog">
<meta name="twitter:description" content="学习总结 思想感悟">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/page/5/"/>

  <title> Skye's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0ad3004c649d5e3dfe7d01df4a20ad3f";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Skye's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Forever youthful,forever weeping</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/18/Mahout 如何进行 Precision 和 Recall 的计算/" itemprop="url">
                  Mahout 如何进行 Precision 和 Recall 的计算
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-18T17:30:00+08:00" content="2016-08-18">
              2016-08-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/推荐系统/" itemprop="url" rel="index">
                    <span itemprop="name">推荐系统</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/18/Mahout 如何进行 Precision 和 Recall 的计算/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/18/Mahout 如何进行 Precision 和 Recall 的计算/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/18/Mahout 如何进行 Precision 和 Recall 的计算/" class="leancloud_visitors" data-flag-title="Mahout 如何进行 Precision 和 Recall 的计算">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>当为某一个用户做推荐评估时，选择一个临界值，以该临界值为参照为该用户构造一个目标最大击中集（即相关项RelevantItemsIDs），然后将该用户数据中的包含在最大击中集中的物品去除，这样形成一个新的训练集。这个新的训练集中，只是去除了部分数据。然后，使用该训练集为该用户进行推荐。如果推荐的物品包含在最大击中集中，则说明击中。依照这个办法为该用户计算 Precision 和 Recall 值。依照这个办法为所有的用户计算 Precision 和 Recall 值。然后，Precision 和 Recall 的平均值作为模型的 Precision 和 Recall 值。</p>
</blockquote>
<p>RecommenderIRStatsEvaluator是一个接口，用于得到推荐系统的准确率，召回率等统计指标。<br>它定义的函数如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public IRStatistics evaluate(RecommenderBuilder recommenderBuilder, DataModelBuilder dataModelBuilder, DataModel dataModel, IDRescorer rescorer, int at, double relevanceThreshold, doubleevaluationPercentage) </div><div class="line">/**</div><div class="line">   * @param recommenderBuilder</div><div class="line">   * 它通过public Recommender buildRecommender(DataModel model)定义推荐系统创建的方式；       </div><div class="line"></div><div class="line">   * @param dataModelBuilder</div><div class="line">   * 数据模型创建的方式，如果已经创建好了数据模型，一般这个参数可以为null</div><div class="line"></div><div class="line">   * @param dataModel</div><div class="line">   * 推荐系统使用的数据模型</div><div class="line">   * </div><div class="line">   * @param rescorer</div><div class="line">   * 推荐排序的方式，一般情况下可以为null</div><div class="line">   * </div><div class="line">   * @param at</div><div class="line">   * 推荐几个物品（TOPN),，它用来定义计算准确率的时候，一个user可以拥有的相关项items的最大个数，相关项item定义为user对这个item的评价超过了relevanceThreshold的项</div><div class="line"></div><div class="line">   * @param relevanceThreshold</div><div class="line">   * 相关临界值 ,和at一起使用定义一个user的相关项</div></pre></td></tr></table></figure></p>
<h3 id="计算临界值"><a href="#计算临界值" class="headerlink" title="计算临界值"></a>计算临界值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//computeThreshold(prefs)这个方法主要是计算得到当前用户对物品 打分的平均值加上标准差的值</div><div class="line">double theRelevanceThreshold = Double.isNaN(relevanceThreshold) ? computeThreshold(prefs)</div><div class="line">					: relevanceThreshold;</div></pre></td></tr></table></figure>
<h3 id="getRelevantItemsIDs"><a href="#getRelevantItemsIDs" class="headerlink" title="getRelevantItemsIDs"></a>getRelevantItemsIDs</h3><p>按照用户对物品的打分从大到小排序，将大于设定的的relevanceTheshold的值存入relevantItemIDs中，relevantItemIDs最大值为at<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * getRelevantItemsIDs的实现，</div><div class="line"> *1.首先得到userID的Preferences </div><div class="line"> *2.创建一个FastIDSet用来保存相关项的id，大小为at </div><div class="line"> *3.prefs根据值大小排序 </div><div class="line"> *4.遍历pref，如果user对这个item的评价prefs.getValue(i)不小于相关阈值，则将这个item的加入相关项，最多取at个满足条件的item</div><div class="line"> */</div><div class="line">FastIDSet relevantItemIDs = dataSplitter.getRelevantItemsIDs(userID, at, theRelevanceThreshold, dataModel);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public FastIDSet getRelevantItemsIDs(long userID,</div><div class="line">                                       int at,</div><div class="line">                                       double relevanceThreshold,</div><div class="line">                                       DataModel dataModel) throws TasteException &#123;</div><div class="line">    PreferenceArray prefs = dataModel.getPreferencesFromUser(userID);</div><div class="line">	//定义最大理论击中物品集合 </div><div class="line">    FastIDSet relevantItemIDs = new FastIDSet(at);</div><div class="line">	//将用户的打分排序 </div><div class="line">    prefs.sortByValueReversed();</div><div class="line">    for (int i = 0; i &lt; prefs.length() &amp;&amp; relevantItemIDs.size() &lt; at; i++) &#123;</div><div class="line">      if (prefs.getValue(i) &gt;= relevanceThreshold) &#123;</div><div class="line">        relevantItemIDs.add(prefs.getItemID(i));</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    return relevantItemIDs;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="获取训练集"><a href="#获取训练集" class="headerlink" title="获取训练集"></a>获取训练集</h3><p>这个训练集的构造规则是： </p>
<ol>
<li>对于其它的用户，将他们所有的（item，preference）都加入训练集； </li>
<li>对于这个用户user，将它的除了相关项之外的其它项的喜好加入训练集；</li>
</ol>
<p>然后，我们使用推荐算法进行推荐。推荐的时候，我们就可能给UserID 推荐移除的物品或者其他的物品。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">FastByIDMap&lt;PreferenceArray&gt; trainingUsers = new FastByIDMap&lt;PreferenceArray&gt;(dataModel.getNumUsers());</div><div class="line">			//对所有用户进行处理</div><div class="line">			//processOtherUser :Adds a single user and all their preferences to the training model.</div><div class="line">			LongPrimitiveIterator it2 = dataModel.getUserIDs();</div><div class="line">			while (it2.hasNext()) &#123;</div><div class="line">				dataSplitter.processOtherUser(userID, relevantItemIDs, trainingUsers, it2.nextLong(), dataModel);</div><div class="line">			&#125;</div></pre></td></tr></table></figure></p>
<h3 id="构造训练模型"><a href="#构造训练模型" class="headerlink" title="构造训练模型"></a>构造训练模型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataModel trainingModel = dataModelBuilder == null ? new GenericDataModel(trainingUsers): dataModelBuilder.buildDataModel(trainingUsers);</div></pre></td></tr></table></figure>
<h3 id="进行推荐"><a href="#进行推荐" class="headerlink" title="进行推荐"></a>进行推荐</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Recommender recommender = recommenderBuilder.buildRecommender(trainingModel);</div><div class="line"></div><div class="line">int intersectionSize = 0;</div><div class="line"></div><div class="line">List&lt;RecommendedItem&gt; recommendedItems = recommender.recommend(userID, at, rescorer);</div></pre></td></tr></table></figure>
<h3 id="计算推荐结果包含在相关项中的个数"><a href="#计算推荐结果包含在相关项中的个数" class="headerlink" title="计算推荐结果包含在相关项中的个数"></a>计算推荐结果包含在相关项中的个数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">List&lt;RecommendedItem&gt; recommendedItems = recommender.recommend(userID, at, rescorer);</div><div class="line"></div><div class="line">			for (RecommendedItem recommendedItem : recommendedItems) &#123;</div><div class="line"></div><div class="line">				if (relevantItemIDs.contains(recommendedItem.getItemID())) &#123;</div><div class="line">					intersectionSize++;</div><div class="line">				&#125;</div><div class="line">			&#125;</div></pre></td></tr></table></figure>
<h3 id="计算查全率、查准率"><a href="#计算查全率、查准率" class="headerlink" title="计算查全率、查准率"></a>计算查全率、查准率</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">int numRecommendedItems = recommendedItems.size();</div><div class="line"></div><div class="line">			// Precision</div><div class="line">			if (numRecommendedItems &gt; 0) &#123;</div><div class="line">				precision.addDatum((double) intersectionSize / (double) numRecommendedItems);</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			// Recall</div><div class="line">			recall.addDatum((double) intersectionSize / (double) numRelevantItems);</div></pre></td></tr></table></figure>
<p>参考</p>
<blockquote>
<p><a href="http://pan.baidu.com/s/1pKE97wJ" target="_blank" rel="external">http://pan.baidu.com/s/1pKE97wJ</a><br><a href="http://www.myexception.cn/cloud/1983215.html" target="_blank" rel="external">http://www.myexception.cn/cloud/1983215.html</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/17/Ubuntu16.04安装Oracle11g/" itemprop="url">
                  Ubuntu16.04安装Oracle11g
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-17T23:36:50+08:00" content="2016-08-17">
              2016-08-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/17/Ubuntu16.04安装Oracle11g/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/17/Ubuntu16.04安装Oracle11g/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/17/Ubuntu16.04安装Oracle11g/" class="leancloud_visitors" data-flag-title="Ubuntu16.04安装Oracle11g">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Oracle用户创建"><a href="#Oracle用户创建" class="headerlink" title="Oracle用户创建"></a>Oracle用户创建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo groupadd oinstall</div><div class="line">sudo groupadd dba</div><div class="line">sudo adduser -g oinstall -G dba -s  oracle</div><div class="line">sudo passwd oracle</div></pre></td></tr></table></figure>
<h3 id="修改-etc-sysctl-conf增加以下内容"><a href="#修改-etc-sysctl-conf增加以下内容" class="headerlink" title="修改/etc/sysctl.conf增加以下内容"></a>修改/etc/sysctl.conf增加以下内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">kernel.sem = 250 32000 100 128</div><div class="line">kernel.shmall = 2097152</div><div class="line">kernel.shmmni = 4096</div><div class="line">kernel.shmmax=1073741824</div><div class="line">net.ipv4.ip_local_port_range = 9000  65500</div><div class="line">net.core.rmem_default = 262144</div><div class="line">net.core.rmem_max = 4194304</div><div class="line">net.core.wmem_default = 262144</div><div class="line">net.core.wmem_max = 1048576</div><div class="line">fs.aio-max-nr = 1048576</div><div class="line">fs.file-max = 6815744</div><div class="line">vm.hugetlb_shm_group = 1002</div></pre></td></tr></table></figure>
<h3 id="运行一下命令更新内核参数"><a href="#运行一下命令更新内核参数" class="headerlink" title="运行一下命令更新内核参数"></a>运行一下命令更新内核参数</h3><p><code>sudo sysctl -p</code></p>
<h3 id="修改-etc-security-limits-conf增加以下内容"><a href="#修改-etc-security-limits-conf增加以下内容" class="headerlink" title="修改/etc/security/limits.conf增加以下内容"></a>修改/etc/security/limits.conf增加以下内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">oracle soft nproc  2047</div><div class="line">oracle hard nproc  16384</div><div class="line">oracle soft nofile 1024</div><div class="line">oracle hard nofile 65536</div><div class="line">oracle soft stack  10240</div></pre></td></tr></table></figure>
<h3 id="修改-etc-pam-d-login增加以下内容"><a href="#修改-etc-pam-d-login增加以下内容" class="headerlink" title="修改/etc/pam.d/login增加以下内容"></a>修改/etc/pam.d/login增加以下内容</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">session required /lib/security/pam_limits.so</div><div class="line">session required pam_limits.so</div></pre></td></tr></table></figure>
<h3 id="欺骗oracle的安装程序"><a href="#欺骗oracle的安装程序" class="headerlink" title="欺骗oracle的安装程序"></a>欺骗oracle的安装程序</h3><p>oracle本身并不支持ubuntu来安装，所以要进行欺骗oracle的安装程序（sudo执行）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">mkdir /usr/lib64</div><div class="line">ln -s /etc /etc/rc.d</div><div class="line">ln -s /lib/x86_64-linux-gnu/libgcc_s.so.1 /lib64/</div><div class="line">ln -s /usr/bin/awk /bin/awk</div><div class="line">ln -s /usr/bin/basename /bin/basename</div><div class="line">ln -s /usr/bin/rpm /bin/rpm</div><div class="line">ln -s /usr/lib/x86_64-linux-gnu/libc_nonshared.a /usr/lib64/</div><div class="line">ln -s /usr/lib/x86_64-linux-gnu/libpthread_nonshared.a /usr/lib64/</div><div class="line">ln -s /usr/lib/x86_64-linux-gnu/libstdc++.so.6 /lib64/</div><div class="line">ln -s /usr/lib/x86_64-linux-gnu/libstdc++.so.6 /usr/lib64/</div><div class="line">vim /etc/redhat-release</div><div class="line">echo &apos;Red Hat Linux release 5&apos; &gt; /etc/redhat-release</div></pre></td></tr></table></figure></p>
<h3 id="为Oracle配置环境变量"><a href="#为Oracle配置环境变量" class="headerlink" title="为Oracle配置环境变量"></a>为Oracle配置环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#oracle安装目录，第6步创建的文件夹</div><div class="line">export ORACLE_BASE=/home/oracle/oracle11g</div><div class="line">#网上说可以随便写</div><div class="line">export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_1</div><div class="line">#数据库的sid</div><div class="line">export ORACLE_SID=orcl</div><div class="line">export ORACLE_UNQNAME=orcl</div><div class="line">#默认字符集</div><div class="line">export NLS_LANG=.AL32UTF8</div><div class="line">#环境变量</div><div class="line">export PATH=$&#123;PATH&#125;:$&#123;ORACLE_HOME&#125;/bin/:$ORACLE_HOME/lib64;</div></pre></td></tr></table></figure>
<h3 id="安装oracle"><a href="#安装oracle" class="headerlink" title="安装oracle"></a>安装oracle</h3><p>上面的系统配置完成之后，最好重启一下服务器，<strong>使用oracle用户登陆系统</strong>。</p>
<ol>
<li>上传下载好的oracle压缩文件到/home/oracle目录下。</li>
<li>进入/home/oracle目录，执行# unzip linux.x64_11gR2_database_1of2.zip和# unzip linux.x64_11gR2_database_2of2.zip，解压的文件在/home/oracle/database目录中。</li>
<li><p>设置/home/oracle/database目录的权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># chown oracle:oinstall /home/oracle/database -R</div><div class="line"># chmod 775 /home/oracle/database -R</div></pre></td></tr></table></figure>
</li>
<li><p>进入/home/oracle/database目录，执行$ ./runInstaller，当检查均通过，会出现oracle安装界面,一路next，有一步可以选择字符，选utf8</p>
</li>
</ol>
<h3 id="安装过程可能遇到的问题"><a href="#安装过程可能遇到的问题" class="headerlink" title="安装过程可能遇到的问题"></a>安装过程可能遇到的问题</h3><ul>
<li><p>Oracle安装界面乱码解决方法<br>执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">exportNLS_LANG=AMERICAN_AMERICA.UTF8</div><div class="line">export LC_ALL=C</div></pre></td></tr></table></figure>
</li>
<li><p>Error in invoking target ‘install’ of makefile ‘/home/dong/tools/oracle11g/product/11.2.0/dbhome_1/ctx/lib/ins_ctx.mk’. See ‘/home/dong/tools/oraInventory/logs/installActions2015-01-22_09-39-03AM.log’ for details.</p>
<p>解决方法：</p>
<p>从<a href="http://download.csdn.net/detail/adnerly/9467935下载，使用rpm安装这个glibc-static-2.17-55.el7.x86_64.rpm资源，安装即可，" target="_blank" rel="external">http://download.csdn.net/detail/adnerly/9467935下载，使用rpm安装这个glibc-static-2.17-55.el7.x86_64.rpm资源，安装即可，</a> 然后点击retry ，接着往下执行<br>注:这是网上提供的解决方案，我的系统安装失败，我直接跳过了 </p>
</li>
</ul>
<ul>
<li><p>Error in invoking target ‘agent nmhs’ of makefile ‘/home/dong/tools/oracle11g/product/11.2.0/dbhome_1/sysman/lib/ins_emagent.mk’</p>
<p>解决方法：</p>
<p>打开新的终端窗口<br>使用vi命令，打开<code>/home/oracle/oracle11g/product/11.2.0/dbhome_1/sysman/lib/ins_emagent.mk</code>文件，将$(MK_EMAGENT_NMECTL)修改成$(MK_EMAGENT_NMECTL)-lnnz11 即可，然后点击retry ，接着往下执行</p>
</li>
</ul>
<ul>
<li><p>Error in invoking target ‘all_no_orcl’ of makefile ‘/home/oracle/oracle11g/product/11.2.0/dbhome_1/rdbms/lib/ins_rdbms.mk’. See ‘/home/dong/tools/Inventory/logs/installActions2016-03-19_02-37-44PM.log’ for details.</p>
<p>解决办法：</p>
<p>打开一个新的终端，输入如下四个命令：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sed -i &apos;s/^\(TNSLSNR_LINKLINE.*\$(TNSLSNR_OFILES)\) \(\$(LINKTTLIBS)\)/\1 -Wl,--no-as-needed \2/g&apos; $ORACLE_HOME/network/lib/env_network.mk</div><div class="line"></div><div class="line">sed -i &apos;s/^\(ORACLE_LINKLINE.*\$(ORACLE_LINKER)\) \(\$(PL_FLAGS)\)/\1 -Wl,--no-as-needed \2/g&apos; $ORACLE_HOME/rdbms/lib/env_rdbms.mk</div><div class="line"></div><div class="line">sed -i &apos;s/^\(\$LD \$LD_RUNTIME\) \(\$LD_OPT\)/\1 -Wl,--no-as-needed \2/g&apos; $ORACLE_HOME/bin/genorasdksh</div><div class="line"></div><div class="line">sed -i &apos;s/^\(\s*\)\(\$(OCRLIBS_DEFAULT)\)/\1 -Wl,--no-as-needed \2/g&apos; $ORACLE_HOME/srvm/lib/ins_srvm.mk</div></pre></td></tr></table></figure>
<p>然后在图形界面点击‘Retry’就能继续安装了。</p>
<h3 id="然后按照安装程序提示最后执行两个脚本"><a href="#然后按照安装程序提示最后执行两个脚本" class="headerlink" title="然后按照安装程序提示最后执行两个脚本"></a>然后按照安装程序提示最后执行两个脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo  /home/oracle/Inventory/orainstRoot.sh </div><div class="line">sudo /home/oracle/oracle11g/product/11.2.0/dbhome_1/root.sh</div></pre></td></tr></table></figure>
<h3 id="创建监听，执行-netca启动配置界面"><a href="#创建监听，执行-netca启动配置界面" class="headerlink" title="创建监听，执行$ netca启动配置界面"></a>创建监听，执行<code>$ netca</code>启动配置界面</h3><p>参考</p>
<blockquote>
<p><a href="http://www.jianshu.com/p/9b2f601c275d" target="_blank" rel="external">http://www.jianshu.com/p/9b2f601c275d</a></p>
</blockquote>
<p>完成之后，执行命令$ lsnrctl start启动监听服务。</p>
<h3 id="创建数据库实例，执行-dbca启动配置界面"><a href="#创建数据库实例，执行-dbca启动配置界面" class="headerlink" title="创建数据库实例，执行$ dbca启动配置界面"></a>创建数据库实例，执行$ dbca启动配置界面</h3><h3 id="最后验证是否安装成功，浏览器访问"><a href="#最后验证是否安装成功，浏览器访问" class="headerlink" title="最后验证是否安装成功，浏览器访问"></a>最后验证是否安装成功，浏览器访问</h3><p><a href="https://192.168.1.114:1158/em" target="_blank" rel="external">https://192.168.1.114:1158/em</a></p>
<h3 id="创建开机自动启动数据库的脚本"><a href="#创建开机自动启动数据库的脚本" class="headerlink" title="创建开机自动启动数据库的脚本"></a>创建开机自动启动数据库的脚本</h3><p>开一个普通的字符终端连接到UbuntuServer，运行如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"># vi /etc/init.d/Oracledb</div><div class="line">文件内容如下：</div><div class="line">#!/bin/bash</div><div class="line">#</div><div class="line"># /etc/init.d/oracledb</div><div class="line">#</div><div class="line"># Run-level Startup script for the Oracle Instance, Listener, and</div><div class="line"># Web Interface</div><div class="line"></div><div class="line">export ORACLE_HOME=/home/oracle/oracle11g/product/11.2.0/dbhome_1</div><div class="line">export ORACLE_SID=orcl</div><div class="line">export PATH=$ORACLE_HOME/bin:$PATH</div><div class="line"></div><div class="line">ORA_OWNR=&quot;oracle&quot;</div><div class="line"># if the executables do not exist -- display error</div><div class="line">if [ ! -f $ORACLE_HOME/bin/dbstart -o ! -d $ORACLE_HOME ]</div><div class="line">then</div><div class="line">echo &quot;Oracle startup: cannot start&quot;</div><div class="line">exit 1</div><div class="line">fi</div><div class="line"># depending on parameter -- startup, shutdown, restart</div><div class="line"># of the instance and listener or usage display</div><div class="line">case &quot;$1&quot; in</div><div class="line">start)</div><div class="line"># Oracle listener and instance startup</div><div class="line">echo -n &quot;Starting Oracle: &quot;</div><div class="line">su $ORA_OWNR -c &quot;$ORACLE_HOME/bin/lsnrctl start&quot;</div><div class="line">su $ORA_OWNR -c &quot;$ORACLE_HOME/bin/dbstart&quot;</div><div class="line">touch /var/lock/oracle</div><div class="line">su $ORA_OWNR -c &quot;$ORACLE_HOME/bin/emctl start dbconsole&quot;</div><div class="line">echo &quot;OK&quot;</div><div class="line">;;</div><div class="line">stop)</div><div class="line"># Oracle listener and instance shutdown</div><div class="line">echo -n &quot;Shutdown Oracle: &quot;</div><div class="line">su $ORA_OWNR -c &quot;$ORACLE_HOME/bin/lsnrctl stop&quot;</div><div class="line">su $ORA_OWNR -c &quot;$ORACLE_HOME/bin/dbshut&quot;</div><div class="line">rm -f /var/lock/oracle</div><div class="line">su $ORA_OWNR -c &quot;$ORACLE_HOME/bin/emctl stop dbconsole&quot;</div><div class="line">echo &quot;OK&quot;</div><div class="line">;;</div><div class="line">reload|restart)</div><div class="line">$0 stop</div><div class="line">$0 start</div><div class="line">;;</div><div class="line">*)</div><div class="line">echo &quot;Usage: `basename $0` start|stop|restart|reload&quot;</div><div class="line">exit 1</div><div class="line">esac</div><div class="line">exit 0</div></pre></td></tr></table></figure></p>
<p>再运行如下命令设置权限，并放到启动脚本中去：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># chmod 755 /etc/init.d/oracledb</div><div class="line"># update-rc.d oracledb defaults 99</div></pre></td></tr></table></figure></p>
<p>最后：<br><code># vi /etc/oratab</code><br>把文件中的N改成Y，即”orcl:/opt/oracle/product/db:N”修改为”orcl:/opt/oracle/product/db:Y”。</p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ ps -ef|grep ora_|grep -v grep  --&gt;查看oracle进程</div><div class="line">$ ps -ef|grep tnslsnr|grep -v grep  --&gt;查看oracle的监听进程</div><div class="line">$ lsnrctl start --&gt;启动监听</div><div class="line">$ dbstart --&gt;启动数据库</div><div class="line">$ dbstop --&gt;停止数据库</div><div class="line">$ emctl start dbconsole --&gt;启动em控制台</div><div class="line">$ isqlplusctl start --&gt;启动pl/sql</div><div class="line">$ sqlplus &apos;/as sysdba&apos; --&gt;登录sqlplus</div><div class="line"></div><div class="line">$ env  --&gt;输出当前用户的环境变量</div><div class="line"></div><div class="line">$ netca --&gt;启用监听配置程序</div></pre></td></tr></table></figure>
<p>参考文章</p>
<blockquote>
<p><a href="CentOS6.7安装Oracle 11g2R傻瓜图文教程">CentOS6.7安装Oracle 11g2R傻瓜图文教程</a><br><a href="http://www.jianshu.com/p/4d7ccf6135af" target="_blank" rel="external">Ubuntu 14.04安装Oracle11g 64位</a><br><a href="http://blog.csdn.net/u010286751/article/details/51975741" target="_blank" rel="external">ubuntu16.04安装oracle11g</a><br><a href="http://www.linuxidc.com/Linux/2011-12/48931.htm" target="_blank" rel="external">Ubuntu Server 11.04 安装 Oracle 11g r2 图解教程</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/17/推荐系统评测指标/" itemprop="url">
                  推荐系统评测指标—准确率(Precision)、召回率(Recall)、F值(F-Measure)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-17T16:26:00+08:00" content="2016-08-17">
              2016-08-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/推荐系统/" itemprop="url" rel="index">
                    <span itemprop="name">推荐系统</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/17/推荐系统评测指标/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/17/推荐系统评测指标/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/17/推荐系统评测指标/" class="leancloud_visitors" data-flag-title="推荐系统评测指标—准确率(Precision)、召回率(Recall)、F值(F-Measure)">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>下面简单列举几种常用的推荐系统评测指标：</p>
<h3 id="准确率与召回率（Precision-amp-Recall）"><a href="#准确率与召回率（Precision-amp-Recall）" class="headerlink" title="准确率与召回率（Precision &amp; Recall）"></a>准确率与召回率（Precision &amp; Recall）</h3><p><strong>准确率</strong>和<strong>召回率</strong>是广泛用于信息检索和统计学分类领域的两个度量值，用来评价结果的质量。其中精度是检索出相关文档数与检索出的文档总数的比率，衡量的是检索系统的查准率；召回率是指检索出的相关文档数和文档库中所有的相关文档数的比率，衡量的是检索系统的查全率。</p>
<p>一般来说，Precision就是检索出来的条目（比如：文档、网页等）有多少是准确的，Recall就是所有准确的条目有多少被检索出来了。</p>
<p>正确率、召回率和 F 值是在鱼龙混杂的环境中，选出目标的重要评价指标。不妨看看这些指标的定义先：</p>
<ol>
<li><p>正确率 = 提取出的正确信息条数 /  提取出的信息条数     </p>
</li>
<li><p>召回率 = 提取出的正确信息条数 /  样本中的信息条数    </p>
<p>两者取值在0和1之间，数值越接近1，查准率或查全率就越高。   </p>
</li>
<li><p>F值  = 正确率 <em> 召回率 </em> 2 / (正确率 + 召回率) （F 值即为正确率和召回率的调和平均值）</p>
</li>
</ol>
<hr>
<p>放到推荐系统中便是</p>
<p>准确率  = 推荐给user的Items中属于user相关项的个数 / 推荐给user的Items的总个数</p>
<p>召回率  =  推荐给user的Items中属于user相关项的个数 / user的所有相关项item个数</p>
<hr>
<p>不妨举这样一个例子：某池塘有1400条鲤鱼，300只虾，300只鳖。现在以捕鲤鱼为目的。撒一大网，逮着了700条鲤鱼，200只虾，100只鳖。那么，这些指标分别如下：</p>
<p>正确率 = 700 / (700 + 200 + 100) = 70%</p>
<p>召回率 = 700 / 1400 = 50%</p>
<p>F值 = 70% <em> 50% </em> 2 / (70% + 50%) = 58.3%</p>
<p>不妨看看如果把池子里的所有的鲤鱼、虾和鳖都一网打尽，这些指标又有何变化：</p>
<p>正确率 = 1400 / (1400 + 300 + 300) = 70%</p>
<p>召回率 = 1400 / 1400 = 100%</p>
<p>F值 = 70% <em> 100% </em> 2 / (70% + 100%) = 82.35%        </p>
<p>由此可见，正确率是评估捕获的成果中目标成果所占得比例；召回率，顾名思义，就是从关注领域中，召回目标类别的比例；而F值，则是综合这二者指标的评估指标，用于综合反映整体的指标。</p>
<p>当然希望检索结果Precision越高越好，同时Recall也越高越好，但事实上这两者在某些情况下有矛盾的。比如极端情况下，我们只搜索出了一个结果，且是准确的，那么Precision就是100%，但是Recall就很低；而如果我们把所有结果都返回，那么比如Recall是100%，但是Precision就会很低。因此在不同的场合中需要自己判断希望Precision比较高或是Recall比较高。如果是做实验研究，可以绘制Precision-Recall曲线来帮助分析。</p>
<h3 id="综合评价指标（F-Measure）"><a href="#综合评价指标（F-Measure）" class="headerlink" title="综合评价指标（F-Measure）"></a>综合评价指标（F-Measure）</h3><p>P和R指标有时候会出现的矛盾的情况，这样就需要综合考虑他们，最常见的方法就是F-Measure（又称为F-Score）。</p>
<p>F-Measure是Precision和Recall加权调和平均：</p>
<p><img src="http://img.blog.csdn.net/20130808110619562" alt=""></p>
<p>当参数α=1时，就是最常见的F1，也即</p>
<p><img src="http://img.blog.csdn.net/20130808110942546" alt=""></p>
<p>可知F1综合了P和R的结果，当F1较高时则能说明试验方法比较有效。</p>
<h3 id="E值"><a href="#E值" class="headerlink" title="E值"></a>E值</h3><p>E值表示查准率P和查全率R的加权平均值，当其中一个为0时，E值为1，其计算公式：</p>
<p><img src="http://img.blog.csdn.net/20131207154559265" alt=""></p>
<p>b越大，表示查准率的权重越大。</p>
<h3 id="平均正确率（Average-Precision-AP）"><a href="#平均正确率（Average-Precision-AP）" class="headerlink" title="平均正确率（Average Precision, AP）"></a>平均正确率（Average Precision, AP）</h3><p>平均正确率表示不同查全率的点上的正确率的平均。</p>
<p>转载自：</p>
<blockquote>
<p><a href="http://bookshadow.com/weblog/2014/06/10/precision-recall-f-measure/" target="_blank" rel="external">http://bookshadow.com/weblog/2014/06/10/precision-recall-f-measure/</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/16/Ubuntu 16.04 mysql安装配置/" itemprop="url">
                  Ubuntu 16.04 mysql安装配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-16T12:00:26+08:00" content="2016-08-16">
              2016-08-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/16/Ubuntu 16.04 mysql安装配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/16/Ubuntu 16.04 mysql安装配置/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/16/Ubuntu 16.04 mysql安装配置/" class="leancloud_visitors" data-flag-title="Ubuntu 16.04 mysql安装配置">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h3><p><code>sudo apt-get install mysql-server mysql-client</code></p>
<h3 id="测试是否安装成功"><a href="#测试是否安装成功" class="headerlink" title="测试是否安装成功"></a>测试是否安装成功</h3><p><code>sudo netstat -tap | grep mysql</code></p>
<h3 id="相关操作"><a href="#相关操作" class="headerlink" title="相关操作"></a>相关操作</h3><ul>
<li>登录 <code>mysql -uroot -p</code></li>
<li>检查MySQL服务器占用端口 <code>netstat -nlt|grep 3306</code></li>
<li>检查MySQL服务器系统进程 <code>ps -aux|grep mysql</code></li>
<li>查看数据库的字符集编码 <code>show variables like &#39;%char%&#39;;</code></li>
</ul>
<h3 id="让MySQL服务器被远程访问"><a href="#让MySQL服务器被远程访问" class="headerlink" title="让MySQL服务器被远程访问"></a>让MySQL服务器被远程访问</h3><ul>
<li><p>打开mysql配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/mysql/my.cnf</div><div class="line">#找到将bind-address = 127.0.0.1注销​</div><div class="line">#bind-address            = 127.0.0.1</div></pre></td></tr></table></figure>
</li>
<li><p>修改后，重启MySQL服务器<br><code>sudo /etc/init.d/mysql restart</code></p>
</li>
<li><p>重新登录<code>mysql -uroot -p</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grant all privileges on *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;xxxxxx&apos;;</div><div class="line">flush privileges;</div></pre></td></tr></table></figure>
</li>
<li><p>检查MySQL服务器占用端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">~ netstat -nlt|grep 3306</div><div class="line">  tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN</div></pre></td></tr></table></figure>
</li>
</ul>
<p>我们看到从之间的网络监听从 127.0.0.1:3306 变成 0 0.0.0.0:3306，表示MySQL已经允许远程登陆访问。</p>
<h3 id="将字符编码设置为UTF-8"><a href="#将字符编码设置为UTF-8" class="headerlink" title="将字符编码设置为UTF-8"></a>将字符编码设置为UTF-8</h3><p>默认情况下，MySQL的字符集是latin1，因此在存储中文的时候，会出现乱码的情况，所以我们需要把字符集统一改成UTF-8。<br>打开mysql配置文件<br><code>sudo vim /etc/mysql/my.cnf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">a） 打开mysql配置文件：</div><div class="line"></div><div class="line">                vim/etc/mysql/my.cnf</div><div class="line">b） 在[client]下追加：</div><div class="line"></div><div class="line">                default-character-set=utf8</div><div class="line">c） 在[mysqld]下追加：</div><div class="line"></div><div class="line">                character-set-server=utf8</div><div class="line">d） 在[mysql]下追加：</div><div class="line"></div><div class="line">                default-character-set=utf8</div></pre></td></tr></table></figure>
<p>修改后，重启MySQL服务器,并登录<br><code>mysql -uroot -p</code></p>
<p>再次查看字符串编码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like &apos;%char%&apos;;</div><div class="line">+--------------------------+----------------------------+</div><div class="line">| Variable_name            | Value                      |</div><div class="line">+--------------------------+----------------------------+</div><div class="line">| character_set_client     | utf8                       |</div><div class="line">| character_set_connection | utf8                       |</div><div class="line">| character_set_database   | utf8                       |</div><div class="line">| character_set_filesystem | binary                     |</div><div class="line">| character_set_results    | utf8                       |</div><div class="line">| character_set_server     | utf8                       |</div><div class="line">| character_set_system     | utf8                       |</div><div class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</div><div class="line">+--------------------------+----------------------------+</div><div class="line">8 rows in set (0.00 sec)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/15/Mahout0.10.1安装/" itemprop="url">
                  Mahout0.10.1安装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-15T20:00:16+08:00" content="2016-08-15">
              2016-08-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/15/Mahout0.10.1安装/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/15/Mahout0.10.1安装/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/15/Mahout0.10.1安装/" class="leancloud_visitors" data-flag-title="Mahout0.10.1安装">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="解压安装包"><a href="#解压安装包" class="headerlink" title="解压安装包"></a>解压安装包</h3><h3 id="编辑环境变量"><a href="#编辑环境变量" class="headerlink" title="编辑环境变量"></a>编辑环境变量</h3><p><code>sudo vim /etc/profile</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#MAHOUT</div><div class="line">export MAHOUT_HOME=/home/ubuntu/cloud/mahout-0.10.1</div><div class="line">export MAHOUT_CONF_DIR=$MAHOUT_HOME/conf</div><div class="line">export HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop</div><div class="line"></div><div class="line">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:$MAHOUT_HOME/conf:$MAHOUT_HOME/bin:</div></pre></td></tr></table></figure></p>
<h3 id="更新配置"><a href="#更新配置" class="headerlink" title="更新配置"></a>更新配置</h3><p><code>source /etc/profile</code></p>
<h3 id="输入mahout测试-出现许多算法"><a href="#输入mahout测试-出现许多算法" class="headerlink" title="输入mahout测试 出现许多算法"></a>输入mahout测试 出现许多算法</h3><h3 id="进行kmeans算法简单运行"><a href="#进行kmeans算法简单运行" class="headerlink" title="进行kmeans算法简单运行"></a>进行kmeans算法简单运行</h3><ul>
<li>下载测试数据集synthetic_control.data<br> <a href="http://archive.ics.uci.edu/ml/databases/synthetic_control/" target="_blank" rel="external">http://archive.ics.uci.edu/ml/databases/synthetic_control/</a></li>
<li>在hdfs上创建目录  <code>/user/ubuntu/testdata</code></li>
<li>上传测试数据<br><code>hadoop fs -put synthetic_control.data /user/ubuntu/testdata</code>  </li>
<li>运行<br><code>mahout org.apache.mahout.clustering.syntheticcontrol.kmeans.Job</code></li>
</ul>
<p>参考</p>
<blockquote>
<p><a href="http://www.cnblogs.com/zhangduo/p/4679907.html" target="_blank" rel="external">http://www.cnblogs.com/zhangduo/p/4679907.html</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/15/Hadoop2.7.2集群搭建/" itemprop="url">
                  Hadoop2.7.2集群搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-15T17:26:16+08:00" content="2016-08-15">
              2016-08-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/15/Hadoop2.7.2集群搭建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/15/Hadoop2.7.2集群搭建/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/15/Hadoop2.7.2集群搭建/" class="leancloud_visitors" data-flag-title="Hadoop2.7.2集群搭建">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="四台电脑集群"><a href="#四台电脑集群" class="headerlink" title="四台电脑集群"></a>四台电脑集群</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">192.168.1.111   master</div><div class="line">192.168.1.112   slave1</div><div class="line">192.168.1.113   slave2</div><div class="line">192.168.1.114   slave3</div></pre></td></tr></table></figure>
<h3 id="修改hosts"><a href="#修改hosts" class="headerlink" title="修改hosts"></a>修改hosts</h3><p><code>vim /etc/hosts</code></p>
<h3 id="配置master到其它三台slave的免密码登陆"><a href="#配置master到其它三台slave的免密码登陆" class="headerlink" title="配置master到其它三台slave的免密码登陆"></a>配置master到其它三台slave的免密码登陆</h3><p>各服务器上使用   ssh-keygen -t rsa    一路按回车就行了。<br>刚才都作甚了呢？主要是设置ssh的密钥和密钥的存放路径。 路径为~/.ssh下。<br>打开~/.ssh 下面有三个文件<br>authorized_keys，已认证的keys<br>id_rsa，私钥<br>id_rsa.pub，公钥   三个文件。<br>下面就是关键的地方了，（我们要做ssh认证。进行下面操作前，可以先搜关于认证和加密区别以及各自的过程。）<br>①在master上将公钥放到authorized_keys里。命令：<br><code>sudo cat id_rsa.pub &gt;&gt; authorized_keys</code><br>②将master上的authorized_keys放到其他linux的~/.ssh目录下。命令：<br><code>sudo scp authorized_keys ubuntu@192.168.1.112:~/.ssh</code><br>sudo scp authorized_keys 远程主机用户名@远程主机名或ip:存放路径。<br>③修改authorized_keys权限，命令：chmod 644 authorized_keys<br>④测试是否成功<br>ssh slave1 输入用户名密码，然后退出，再次ssh slave1不用密码，直接进入系统。这就表示成功了。</p>
<h3 id="安装jdk1-7"><a href="#安装jdk1-7" class="headerlink" title="安装jdk1.7"></a>安装jdk1.7</h3><ol>
<li><code>mkdir /usr/java</code></li>
<li><code>sudo tar -zxvf jdk-7u79-linux-x64.tar.gz -C /usr/java</code></li>
<li><p><code>vim /etc/profile</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/java/jdk1.7.0_79</div><div class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</div><div class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</div></pre></td></tr></table></figure>
</li>
<li><p>刷新配置<br><code>source /etc/profile</code></p>
</li>
<li>测试<br><code>java -version</code></li>
</ol>
<h3 id="关闭每台机器的防火墙"><a href="#关闭每台机器的防火墙" class="headerlink" title="关闭每台机器的防火墙"></a>关闭每台机器的防火墙</h3><p><code>sudo ufw disable</code> (重启生效)</p>
<h3 id="创建-home-cloud目录"><a href="#创建-home-cloud目录" class="headerlink" title="创建/home/cloud目录"></a>创建/home/cloud目录</h3><p><code>mkdir ~/cloud</code></p>
<h3 id="解压hadoop"><a href="#解压hadoop" class="headerlink" title="解压hadoop"></a>解压hadoop</h3><p><code>tar -zxvf hadoop-2.7.2.tar.gz -C ./cloud</code></p>
<h3 id="配置hadoop-env-sh-yarn-env-sh"><a href="#配置hadoop-env-sh-yarn-env-sh" class="headerlink" title="配置hadoop-env.sh yarn-env.sh"></a>配置hadoop-env.sh yarn-env.sh</h3><p>修改JAVA_HOME值<code>export JAVA_HOME=/usr/java/jdk1.7.0_79</code></p>
<h3 id="创建文件夹"><a href="#创建文件夹" class="headerlink" title="创建文件夹"></a>创建文件夹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir /home/ubuntu/cloud/hadoop-2.7.2/tmp</div><div class="line">mkdir /home/ubuntu/cloud/hadoop-2.7.2/dfs/data</div><div class="line">mkdir /home/ubuntu/cloud/hadoop-2.7.2/dfs/name</div></pre></td></tr></table></figure>
<h3 id="配置slaves"><a href="#配置slaves" class="headerlink" title="配置slaves"></a>配置slaves</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">slave1</div><div class="line">slave2</div><div class="line">slave3</div></pre></td></tr></table></figure>
<h3 id="配置core-site-xml"><a href="#配置core-site-xml" class="headerlink" title="配置core-site.xml"></a>配置core-site.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;configuration&gt;</div><div class="line">       &lt;property&gt;</div><div class="line">                &lt;name&gt;fs.defaultFS&lt;/name&gt;</div><div class="line">                &lt;value&gt;hdfs://master:9000&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">       &lt;property&gt;</div><div class="line">                &lt;name&gt;io.file.buffer.size&lt;/name&gt;</div><div class="line">                &lt;value&gt;131072&lt;/value&gt;</div><div class="line">        &lt;/property&gt;</div><div class="line">       &lt;property&gt;</div><div class="line">               &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</div><div class="line">               &lt;value&gt;file:/home/ubuntu/cloud/hadoop-2.7.2/tmp&lt;/value&gt;</div><div class="line">               &lt;description&gt;Abase for other temporary   directories.&lt;/description&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">        &lt;property&gt;</div><div class="line">               &lt;name&gt;hadoop.proxyuser.ubuntu.hosts&lt;/name&gt;</div><div class="line">               &lt;value&gt;*&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">       &lt;property&gt;</div><div class="line">               &lt;name&gt;hadoop.proxyuser.ubuntu.groups&lt;/name&gt;</div><div class="line">               &lt;value&gt;*&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure>
<h3 id="配置hdfs-site-xml"><a href="#配置hdfs-site-xml" class="headerlink" title="配置hdfs-site.xml"></a>配置hdfs-site.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;configuration&gt;  </div><div class="line">    &lt;property&gt;  </div><div class="line">        &lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;  </div><div class="line">        &lt;value&gt;master:9001&lt;/value&gt;  </div><div class="line">    &lt;/property&gt;  </div><div class="line">    &lt;property&gt;  </div><div class="line">        &lt;name&gt;dfs.replication&lt;/name&gt;  </div><div class="line">        &lt;value&gt;4&lt;/value&gt;  </div><div class="line">    &lt;/property&gt;  </div><div class="line">    &lt;property&gt;  </div><div class="line">        &lt;name&gt;dfs.permissions.enabled&lt;/name&gt;  </div><div class="line">        &lt;value&gt;false&lt;/value&gt;  </div><div class="line">    &lt;/property&gt;  </div><div class="line">    &lt;property&gt;  </div><div class="line">        &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;  </div><div class="line">        &lt;value&gt;file:/home/ubuntu/cloud/hadoop-2.7.2/dfs/name&lt;/value&gt;  </div><div class="line">    &lt;/property&gt;  </div><div class="line">    &lt;property&gt;  </div><div class="line">        &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;  </div><div class="line">        &lt;value&gt;file:/home/ubuntu/cloud/hadoop-2.7.2/dfs/data&lt;/value&gt;  </div><div class="line">    &lt;/property&gt;  </div><div class="line">    &lt;property&gt;  </div><div class="line">        &lt;name&gt;dfs.webhdfs.enabled&lt;/name&gt;  </div><div class="line">        &lt;value&gt;true&lt;/value&gt;  </div><div class="line">    &lt;/property&gt;  </div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure>
<h3 id="配置mapred-site-xml"><a href="#配置mapred-site-xml" class="headerlink" title="配置mapred-site.xml"></a>配置mapred-site.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;configuration&gt;</div><div class="line">          &lt;property&gt;                                                                  &lt;name&gt;mapreduce.framework.name&lt;/name&gt;</div><div class="line">                &lt;value&gt;yarn&lt;/value&gt;</div><div class="line">           &lt;/property&gt;</div><div class="line">          &lt;property&gt;</div><div class="line">                  &lt;name&gt;mapreduce.jobhistory.address&lt;/name&gt;</div><div class="line">                  &lt;value&gt;master:10020&lt;/value&gt;</div><div class="line">          &lt;/property&gt;</div><div class="line">          &lt;property&gt;</div><div class="line">                &lt;name&gt;mapreduce.jobhistory.webapp.address&lt;/name&gt;</div><div class="line">                &lt;value&gt;master:19888&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure>
<h3 id="配置yarn-site-xml"><a href="#配置yarn-site-xml" class="headerlink" title="配置yarn-site.xml"></a>配置yarn-site.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;configuration&gt;</div><div class="line">        &lt;property&gt;</div><div class="line">               &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;</div><div class="line">               &lt;value&gt;mapreduce_shuffle&lt;/value&gt;</div><div class="line">        &lt;/property&gt;</div><div class="line">        &lt;property&gt;                                                                </div><div class="line">            &lt;name&gt;yarn.nodemanager.aux-services.mapreduce.shuffle.class&lt;/name&gt;</div><div class="line">               &lt;value&gt;org.apache.hadoop.mapred.ShuffleHandler&lt;/value&gt;</div><div class="line">        &lt;/property&gt;</div><div class="line">        &lt;property&gt;</div><div class="line">               &lt;name&gt;yarn.resourcemanager.address&lt;/name&gt;</div><div class="line">               &lt;value&gt;master:8032&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">       &lt;property&gt;</div><div class="line">               &lt;name&gt;yarn.resourcemanager.scheduler.address&lt;/name&gt;</div><div class="line">               &lt;value&gt;master:8030&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">       &lt;property&gt;</div><div class="line">            &lt;name&gt;yarn.resourcemanager.resource-tracker.address&lt;/name&gt;</div><div class="line">             &lt;value&gt;master:8031&lt;/value&gt;</div><div class="line">      &lt;/property&gt;</div><div class="line">      &lt;property&gt;</div><div class="line">              &lt;name&gt;yarn.resourcemanager.admin.address&lt;/name&gt;</div><div class="line">               &lt;value&gt;master:8033&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">       &lt;property&gt;</div><div class="line">               &lt;name&gt;yarn.resourcemanager.webapp.address&lt;/name&gt;</div><div class="line">               &lt;value&gt;master:8088&lt;/value&gt;</div><div class="line">       &lt;/property&gt;</div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure>
<h3 id="复制到其它节点"><a href="#复制到其它节点" class="headerlink" title="复制到其它节点"></a>复制到其它节点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo scp -r /home/ubuntu/cloud ubuntu@slave1:~/</div><div class="line">sudo scp -r /home/ubuntu/cloud ubuntu@slave2:~/</div><div class="line">sudo scp -r /home/ubuntu/cloud ubuntu@slave3:~/</div></pre></td></tr></table></figure>
<h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><p><code>vim /etc/profile</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export HADOOP_HOME=/home/ubuntu/cloud/hadoop-2.7.2</div><div class="line">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin:$HADOOP_HOME/bin:$HADOOP_HOME/sbin:</div></pre></td></tr></table></figure></p>
<h3 id="启动hadoop"><a href="#启动hadoop" class="headerlink" title="启动hadoop"></a>启动hadoop</h3><ul>
<li>格式化namenode <code>hadoop namenode –format</code></li>
<li>启动hdfs <code>start-dfs.sh</code></li>
<li>启动yarn <code>start-yarn.sh</code></li>
<li>web端查看 <code>http://master:8088 http://master:50070</code></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/15/ubuntu相关设置/" itemprop="url">
                  ubuntu相关设置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-15T00:39:26+08:00" content="2016-08-15">
              2016-08-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/15/ubuntu相关设置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/15/ubuntu相关设置/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/15/ubuntu相关设置/" class="leancloud_visitors" data-flag-title="ubuntu相关设置">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h3><p><code>sudo dpkg-reconfigure tzdata</code></p>
<p>出现时区列表，按照提示选择“Asia/Shanghai”</p>
<p>结果如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">Package configuration</div><div class="line"></div><div class="line">     ┌───────────────────────┤ Configuring tzdata ├───────────────────────┐</div><div class="line">     │ Please select the city or region corresponding to your time zone.  │</div><div class="line">     │                                                                    │</div><div class="line">     │ Time zone:                                                         │</div><div class="line">     │                                                                    │</div><div class="line">     │                          Qyzylorda        ↑                        │</div><div class="line">     │                          Rangoon          ▒                        │</div><div class="line">     │                          Riyadh           ▒                        │</div><div class="line">     │                          Sakhalin         ▒                        │</div><div class="line">     │                          Samarkand        ▒                        │</div><div class="line">     │                          Seoul            ▒                        │</div><div class="line">     │                          Shanghai         ▮                        │</div><div class="line">     │                          Singapore        ▒                        │</div><div class="line">     │                          Srednekolymsk    ▒                        │</div><div class="line">     │                          Taipei           ↓                        │</div><div class="line">     │                                                                    │</div><div class="line">     │                                                                    │</div><div class="line">     │                 &lt;Ok&gt;                     &lt;Cancel&gt;                  │</div><div class="line">     │                                                                    │</div><div class="line">     └────────────────────────────────────────────────────────────────────┘</div><div class="line"></div><div class="line">                                                                               </div><div class="line">Current default time zone: &apos;Asia/Shanghai&apos;</div><div class="line">Local time is now:      Mon Aug 15 00:11:59 CST 2016.</div><div class="line">Universal Time is now:  Sun Aug 14 16:11:59 UTC 2016.</div><div class="line"></div><div class="line">ubuntu@master:~$ date</div><div class="line">Mon Aug 15 00:12:13 CST 2016</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/14/ubuntu设置静态ip/" itemprop="url">
                  ubuntu设置静态ip
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-14T23:58:26+08:00" content="2016-08-14">
              2016-08-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/14/ubuntu设置静态ip/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/14/ubuntu设置静态ip/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/08/14/ubuntu设置静态ip/" class="leancloud_visitors" data-flag-title="ubuntu设置静态ip">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="找到文件并作如下修改"><a href="#找到文件并作如下修改" class="headerlink" title="找到文件并作如下修改"></a>找到文件并作如下修改</h3><p><code>sudo vim /etc/network/interfaces</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># The primary network interface</div><div class="line">auto eno1</div><div class="line">iface eno1 inet static</div><div class="line">        address 192.168.1.111</div><div class="line">        netmask 255.255.255.0</div><div class="line">        network 192.168.1.0</div><div class="line">        broadcast 192.168.1.255</div><div class="line">        gateway 192.168.1.1</div><div class="line">        # dns-* options are implemented by the resolvconf package, if installed</div><div class="line">        dns-nameservers 202.101.172.35 202.101.172.46</div></pre></td></tr></table></figure>
<h3 id="修改dns解析"><a href="#修改dns解析" class="headerlink" title="修改dns解析"></a>修改dns解析</h3><p>因为以前是dhcp解析，所以会自动分配dns服务器地址</p>
<p>而一旦设置为静态ip后就没有自动获取到的dns服务器了</p>
<p>要自己设置一个</p>
<p><code>sudo vim /etc/resolv.conf</code></p>
<p>写上一个公网的DNS,以下为浙江杭州电信DNS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</div><div class="line">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</div><div class="line">nameserver 202.101.172.35</div><div class="line">nameserver 202.101.172.46</div></pre></td></tr></table></figure>
<p>（注意：8.8.8.8是谷歌的DNS服务器，但是解析速度慢，还是找到一个国内的dns来用）</p>
<h3 id="重启网卡"><a href="#重启网卡" class="headerlink" title="重启网卡"></a>重启网卡</h3><p><code>sudo /etc/init.d/networking restart</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/26/JVM内存配置/" itemprop="url">
                  JVM内存配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-26T15:10:59+08:00" content="2016-07-26">
              2016-07-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/26/JVM内存配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/26/JVM内存配置/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/07/26/JVM内存配置/" class="leancloud_visitors" data-flag-title="JVM内存配置">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参数中-vmargs的意思是设置JVM参数，所以后面的其实都是JVM的参数了，我们首先了解一下JVM内存管理的机制，然后再解释每个参数代表的含义。</p>
<h3 id="堆-Heap-和非堆-Non-heap-内存"><a href="#堆-Heap-和非堆-Non-heap-内存" class="headerlink" title="堆(Heap)和非堆(Non-heap)内存"></a>堆(Heap)和非堆(Non-heap)内存</h3><p>按照官方的说法：“Java虚拟机具有一个堆，堆是运行时数据区域，所有类实例和数组的内存均从此处分配。堆是在Java虚拟机启动时创建的。”“在JVM中堆之外的内存称为非堆内存(Non-heapmemory)”。可以看出JVM主要管理两种类型的内存：堆和非堆。简单来说堆就是Java代码可及的内存，是留给开发人员使用的；非堆就是JVM留给自己用的，所以方法区、JVM内部处理或优化所需的内存(如JIT编译后的代码缓存)、每个类结构(如运行时常数池、字段和方法数据)以及方法和构造方法的代码都在非堆内存中。</p>
<h3 id="堆内存分配"><a href="#堆内存分配" class="headerlink" title="堆内存分配"></a>堆内存分配</h3><p>JVM初始分配的内存由-Xms指定，默认是物理内存的1/64；JVM最大分配的内存由-Xmx指定，默认是物理内存的1/4。默认空余堆内存小于40%时，JVM就会增大堆直到-Xmx的最大限制；空余堆内存大于70%时，JVM会减少堆直到-Xms的最小限制。因此服务器一般设置-Xms、-Xmx相等以避免在每次GC后调整堆的大小。</p>
<p>非堆内存分配</p>
<p>JVM使用-XX:PermSize设置非堆内存初始值，默认是物理内存的1/64；由XX:MaxPermSize设置最大非堆内存的大小，默认是物理内存的1/4。</p>
<h3 id="JVM内存限制-最大值"><a href="#JVM内存限制-最大值" class="headerlink" title="JVM内存限制(最大值)"></a>JVM内存限制(最大值)</h3><p>首先JVM内存限制于实际的最大物理内存(废话！呵呵)，假设物理内存无限大的话，JVM内存的最大值跟操作系统有很大的关系。简单的说就32位处理器虽然可控内存空间有4GB,但是具体的操作系统会给一个限制，这个限制一般是2GB-3GB（一般来说Windows系统下为1.5G-2G，Linux系统下为2G-3G），而64bit以上的处理器就不会有限制了。</p>
<h3 id="减少jvm内存回收引起的eclipse卡的问题"><a href="#减少jvm内存回收引起的eclipse卡的问题" class="headerlink" title="减少jvm内存回收引起的eclipse卡的问题"></a>减少jvm内存回收引起的eclipse卡的问题</h3><p>这个主要是jvm在client模式，进行内存回收时，会停下所有的其它工作，带回收完毕才去执行其它任务，在这期间eclipse就卡住了。所以适当的增加jvm申请的内存大小来减少其回收的次数甚至不回收，就会是卡的现象有明显改善。 </p>
<p>主要通过以下的几个jvm参数来设置堆内存的： </p>
<ul>
<li>-Xmx512m    最大总堆内存，一般设置为物理内存的1/4</li>
<li>-Xms512m    初始总堆内存，一般将它设置的和最大堆内存一样大，这样就不需要根据当前堆使用情况而调整堆的大小了</li>
<li>-Xmn192m    年轻带堆内存，sun官方推荐为整个堆的3/8</li>
<li>堆内存的组成    总堆内存 = 年轻带堆内存 + 年老带堆内存 + 持久带堆内存</li>
<li>年轻带堆内存    对象刚创建出来时放在这里</li>
<li>年老带堆内存    对象在被真正会回收之前会先放在这里</li>
<li>持久带堆内存    class文件，元数据等放在这里</li>
<li>-XX:PermSize=128m    持久带堆的初始大小</li>
<li>-XX:MaxPermSize=128m    持久带堆的最大大小，eclipse默认为256m。如果要编译jdk这种，一定要把这个设的很大，因为它的类太多了。</li>
</ul>
<h3 id="eclipse运行配置"><a href="#eclipse运行配置" class="headerlink" title="eclipse运行配置"></a>eclipse运行配置</h3><p>Eclipse -&gt; Run -&gt; Run Configurations -&gt; Arguments -&gt; VM arguments<br>或者 Run as -&gt; Run Configurations -&gt; Arguments -&gt; VM arguments<br> -Xms2048m -Xmx2048m<br><img src="http://i.imgur.com/O2JUIKO.png" alt=""></p>
<p>-Xms是设置内存初始化的大小(如上面的2048m)<br>-Xmx是设置最大能够使用内存的大小（如上面的2048m, 最好不要超过物理内存）<br>也可通过 eclipse.ini配置</p>
<p>参考文章：<br><a href="http://blog.csdn.net/gf771115/article/details/20220915" target="_blank" rel="external">Eclipse中进行JVM内存设置</a><br><a href="http://blog.csdn.net/buptdavid/article/details/43270997" target="_blank" rel="external">JVM监控与调优</a><br><a href="http://blog.csdn.net/wuzhilon88/article/details/49201891" target="_blank" rel="external">JVM调优总结(这个总结得比较全面)</a><br><a href="http://uule.iteye.com/blog/2114697" target="_blank" rel="external">JVM性能调优</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/25/Mahout Item-based推荐分布式实现/" itemprop="url">
                  Mahout Item-based推荐的分布式实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-25T16:02:36+08:00" content="2016-07-25">
              2016-07-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/大数据/" itemprop="url" rel="index">
                    <span itemprop="name">大数据</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/25/Mahout Item-based推荐分布式实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/25/Mahout Item-based推荐分布式实现/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/07/25/Mahout Item-based推荐分布式实现/" class="leancloud_visitors" data-flag-title="Mahout Item-based推荐的分布式实现">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Mahout API地址：<a href="http://apache.github.io/mahout/0.10.1/docs/mahout-mr/overview-summary.html" target="_blank" rel="external">http://apache.github.io/mahout/0.10.1/docs/mahout-mr/overview-summary.html</a></p>
<blockquote>
<p><a href="http://blog.fens.me/mahout-recommendation-api/" target="_blank" rel="external">Mahout推荐算法API详解</a></p>
</blockquote>
<h2 id="Mahout算法框架自带的推荐器有下面这些："><a href="#Mahout算法框架自带的推荐器有下面这些：" class="headerlink" title="Mahout算法框架自带的推荐器有下面这些："></a>Mahout算法框架自带的推荐器有下面这些：</h2><ul>
<li>GenericUserBasedRecommender：基于用户的推荐器，用户数量少时速度快；</li>
<li>GenericItemBasedRecommender：基于商品推荐器，商品数量少时速度快，尤其当外部提供了商品相似度数据后效率更好；</li>
<li>SlopeOneRecommender：基于slope-one算法的推荐器，在线推荐或更新较快，需要事先大量预处理运算，物品数量少时较好；</li>
<li>SVDRecommender：奇异值分解，推荐效果较好，但之前需要大量预处理运算；</li>
<li>KnnRecommender：基于k近邻算法(KNN)，适合于物品数量较小时；</li>
<li>TreeClusteringRecommender：基于聚类的推荐器，在线推荐较快，之前需要大量预处理运算，用户数量较少时效果好；</li>
<li>Mahout最常用的三个推荐器是上述的前三个，本文主要讨论前两种的使用。</li>
</ul>
<h2 id="接口相关介绍"><a href="#接口相关介绍" class="headerlink" title="接口相关介绍"></a>接口相关介绍</h2><p>基于用户或物品的推荐器主要包括以下几个接口：</p>
<p><code>DataModel</code> 是用户喜好信息的抽象接口，它的具体实现支持从任意类型的数据源抽取用户喜好信息。Taste 默认提供 JDBCDataModel 和 FileDataModel，分别支持从数据库和文件中读取用户的喜好信息。<br><code>UserSimilarity</code> 和 <code>ItemSimilarity</code>。UserSimilarity 用于定义两个用户间的相似度，它是基于协同过滤的推荐引擎的核心部分，可以用来计算用户的“邻居”，这里我们将与当前用户口味相似的用户称为他的邻居。ItemSimilarity 类似的，计算内容之间的相似度。<br><code>UserNeighborhood</code> 用于基于用户相似度的推荐方法中，推荐的内容是基于找到与当前用户喜好相似的邻居用户的方式产生的。UserNeighborhood 定义了确定邻居用户的方法，具体实现一般是基于 UserSimilarity 计算得到的。<br><code>Recommender</code> 是推荐引擎的抽象接口，Taste 中的核心组件。程序中，为它提供一个 DataModel，它可以计算出对不同用户的推荐内容。实际应用中，主要使用它的实现类 <code>GenericUserBasedRecommender</code> 或者 <code>GenericItemBasedRecommender</code>，分别实现基于用户相似度的推荐引擎或者基于内容的推荐引擎。<br><code>RecommenderEvaluator</code>：评分器。<br><code>RecommenderIRStatsEvaluator</code>：搜集推荐性能相关的指标，包括准确率、召回率等等。<br>目前，Mahout为DataModel提供了以下几种实现：</p>
<ul>
<li>org.apache.mahout.cf.taste.impl.model.GenericDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.GenericBooleanPrefDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.PlusAnonymousUserDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.file.FileDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.hbase.HBaseDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.cassandra.CassandraDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.mongodb.MongoDBDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.SQL92JDBCDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.MySQLJDBCDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.PostgreSQLJDBCDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.GenericJDBCDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.SQL92BooleanPrefJDBCDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.MySQLBooleanPrefJDBCDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.PostgreBooleanPrefSQLJDBCDataModel</li>
<li>org.apache.mahout.cf.taste.impl.model.jdbc.ReloadFromJDBCDataModel<br>从类名上就可以大概猜出来每个DataModel的用途，奇怪的是竟然没有HDFS的DataModel，有人实现了一个，请参考<a href="https://issues.apache.org/jira/browse/MAHOUT-1579" target="_blank" rel="external">MAHOUT-1579</a>。</li>
</ul>
<p><code>UserSimilarity</code> 和 <code>ItemSimilarity</code> 相似度实现有以下几种：</p>
<ul>
<li><code>CityBlockSimilarity</code>：基于Manhattan距离相似度</li>
<li><code>EuclideanDistanceSimilarity</code>：基于欧几里德距离计算相似度</li>
<li><code>LogLikelihoodSimilarity</code>：基于对数似然比的相似度</li>
<li><code>PearsonCorrelationSimilarity</code>：基于皮尔逊相关系数计算相似度</li>
<li><code>SpearmanCorrelationSimilarity</code>：基于皮尔斯曼相关系数相似度</li>
<li><code>TanimotoCoefficientSimilarity</code>：基于谷本系数计算相似度</li>
<li><code>UncenteredCosineSimilarity</code>：计算 Cosine 相似度<br>以上相似度的说明，请参考Mahout推荐引擎介绍。</li>
</ul>
<p>UserNeighborhood 主要实现有两种：</p>
<ul>
<li>NearestNUserNeighborhood：对每个用户取固定数量N个最近邻居</li>
<li>ThresholdUserNeighborhood：对每个用户基于一定的限制，取落在相似度限制以内的所有用户为邻居</li>
</ul>
<p>Recommender分为以下几种实现：</p>
<ul>
<li>GenericUserBasedRecommender：基于用户的推荐引擎</li>
<li>GenericBooleanPrefUserBasedRecommender：基于用户的无偏好值推荐引擎</li>
<li>GenericItemBasedRecommender：基于物品的推荐引擎</li>
<li>GenericBooleanPrefItemBasedRecommender：基于物品的无偏好值推荐引擎</li>
</ul>
<p>RecommenderEvaluator有以下几种实现：</p>
<ul>
<li>AverageAbsoluteDifferenceRecommenderEvaluator：计算平均差值</li>
<li>RMSRecommenderEvaluator：计算均方根差</li>
<li>RecommenderIRStatsEvaluator的实现类是GenericRecommenderIRStatsEvaluator。</li>
</ul>
<h2 id="单机运行"><a href="#单机运行" class="headerlink" title="单机运行"></a>单机运行</h2><p>首先，需要在maven中加入对mahout的依赖：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.mahout&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;mahout-core&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.9&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line"></div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.mahout&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;mahout-integration&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.9&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line"></div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.mahout&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;mahout-math&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.9&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line"></div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.apache.mahout&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;mahout-examples&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;0.9&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>基于用户的推荐，以FileDataModel为例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">File modelFile modelFile = new File(&quot;intro.csv&quot;);</div><div class="line"></div><div class="line">DataModel model = new FileDataModel(modelFile);</div><div class="line"></div><div class="line">//用户相似度，使用基于皮尔逊相关系数计算相似度</div><div class="line">UserSimilarity similarity = new PearsonCorrelationSimilarity(model);</div><div class="line"></div><div class="line">//选择邻居用户，使用NearestNUserNeighborhood实现UserNeighborhood接口，选择邻近的4个用户</div><div class="line">UserNeighborhood neighborhood = new NearestNUserNeighborhood(4, similarity, model);</div><div class="line"></div><div class="line">Recommender recommender = new GenericUserBasedRecommender(model, neighborhood, similarity);</div><div class="line"></div><div class="line">//给用户1推荐4个物品</div><div class="line">List&lt;RecommendedItem&gt; recommendations = recommender.recommend(1, 4);</div><div class="line"></div><div class="line">for (RecommendedItem recommendation : recommendations) &#123;</div><div class="line">    System.out.println(recommendation);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意： FileDataModel要求输入文件中的字段分隔符为逗号或者制表符，如果你想使用其他分隔符，你可以扩展一个FileDataModel的实现，例如，mahout中已经提供了一个解析MoiveLens的数据集（分隔符为::）的实现GroupLensDataModel。</p>
</blockquote>
<p><code>GenericUserBasedRecommender</code>是基于用户的简单推荐器实现类，推荐主要参照传入的DataModel和UserNeighborhood，总体是三个步骤：</p>
<ol>
<li>从UserNeighborhood获取当前用户Ui最相似的K个用户集合{U1, U2, …Uk}；</li>
<li>从这K个用户集合排除Ui的偏好商品，剩下的Item集合为{Item0, Item1, …Itemm}；</li>
<li>对Item集合里每个Itemj计算Ui可能偏好程度值pref(Ui, Itemj)，并把Item按此数值从高到低排序，前N个item推荐给用户Ui。</li>
<li>对相同用户重复获得推荐结果，我们可以改用CachingRecommender来包装GenericUserBasedRecommender对象，将推荐结果缓存起来：</li>
</ol>
<p><code>Recommender cachingRecommender = new CachingRecommender(recommender);</code></p>
<p>上面代码可以在main方法中直接运行，然后，我们可以获取推荐模型的评分：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//使用平均绝对差值获得评分</div><div class="line">RecommenderEvaluator evaluator = new AverageAbsoluteDifferenceRecommenderEvaluator();</div><div class="line">// 用RecommenderBuilder构建推荐引擎</div><div class="line">RecommenderBuilder recommenderBuilder = new RecommenderBuilder() &#123;</div><div class="line">    @Override</div><div class="line">    public Recommender buildRecommender(DataModel model) throws TasteException &#123;</div><div class="line">        UserSimilarity similarity = new PearsonCorrelationSimilarity(model);</div><div class="line">        UserNeighborhood neighborhood = new NearestNUserNeighborhood(4, similarity, model);</div><div class="line">        return new GenericUserBasedRecommender(model, neighborhood, similarity);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">// Use 70% of the data to train; test using the other 30%.</div><div class="line">double score = evaluator.evaluate(recommenderBuilder, null, model, 0.7, 1.0);</div><div class="line">System.out.println(score);</div></pre></td></tr></table></figure></p>
<p>接下来，可以获取推荐结果的查准率和召回率：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">RecommenderIRStatsEvaluator statsEvaluator = new GenericRecommenderIRStatsEvaluator();</div><div class="line">// Build the same recommender for testing that we did last time:</div><div class="line">RecommenderBuilder recommenderBuilder = new RecommenderBuilder() &#123;</div><div class="line">    @Override</div><div class="line">    public Recommender buildRecommender(DataModel model) throws TasteException &#123;</div><div class="line">        UserSimilarity similarity = new PearsonCorrelationSimilarity(model);</div><div class="line">        UserNeighborhood neighborhood = new NearestNUserNeighborhood(4, similarity, model);</div><div class="line">        return new GenericUserBasedRecommender(model, neighborhood, similarity);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">// 计算推荐4个结果时的查准率和召回率</div><div class="line">IRStatistics stats = statsEvaluator.evaluate(recommenderBuilder,null, model, null, 4,</div><div class="line">        GenericRecommenderIRStatsEvaluator.CHOOSE_THRESHOLD,1.0);</div><div class="line">System.out.println(stats.getPrecision());</div><div class="line">System.out.println(stats.getRecall());</div></pre></td></tr></table></figure></p>
<p>如果是基于物品的推荐，代码大体相似，只是没有了UserNeighborhood，然后将上面代码中的User换成Item即可，完整代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">File modelFile modelFile = new File(&quot;intro.csv&quot;);</div><div class="line"></div><div class="line">DataModel model = new FileDataModel(new File(file));</div><div class="line"></div><div class="line">// Build the same recommender for testing that we did last time:</div><div class="line">RecommenderBuilder recommenderBuilder = new RecommenderBuilder() &#123;</div><div class="line">    @Override</div><div class="line">    public Recommender buildRecommender(DataModel model) throws TasteException &#123;</div><div class="line">        ItemSimilarity similarity = new PearsonCorrelationSimilarity(model);</div><div class="line">        return new GenericItemBasedRecommender(model, similarity);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">//获取推荐结果</div><div class="line">List&lt;RecommendedItem&gt; recommendations = recommenderBuilder.buildRecommender(model).recommend(1, 4);</div><div class="line"></div><div class="line">for (RecommendedItem recommendation : recommendations) &#123;</div><div class="line">    System.out.println(recommendation);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//计算评分</div><div class="line">RecommenderEvaluator evaluator =</div><div class="line">        new AverageAbsoluteDifferenceRecommenderEvaluator();</div><div class="line">// Use 70% of the data to train; test using the other 30%.</div><div class="line">double score = evaluator.evaluate(recommenderBuilder, null, model, 0.7, 1.0);</div><div class="line">System.out.println(score);</div><div class="line"></div><div class="line">//计算查全率和查准率</div><div class="line">RecommenderIRStatsEvaluator statsEvaluator = new GenericRecommenderIRStatsEvaluator();</div><div class="line"></div><div class="line">// Evaluate precision and recall &quot;at 2&quot;:</div><div class="line">IRStatistics stats = statsEvaluator.evaluate(recommenderBuilder,</div><div class="line">        null, model, null, 4,</div><div class="line">        GenericRecommenderIRStatsEvaluator.CHOOSE_THRESHOLD,</div><div class="line">        1.0);</div><div class="line">System.out.println(stats.getPrecision());</div><div class="line">System.out.println(stats.getRecall());</div></pre></td></tr></table></figure></p>
<h2 id="在Spark中运行"><a href="#在Spark中运行" class="headerlink" title="在Spark中运行"></a>在Spark中运行</h2><p>在Spark中运行，需要将Mahout相关的jar添加到Spark的classpath中，修改/etc/spark/conf/spark-env.sh，添加下面两行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">SPARK_DIST_CLASSPATH=&quot;$SPARK_DIST_CLASSPATH:/usr/lib/mahout/lib/*&quot;</div><div class="line">SPARK_DIST_CLASSPATH=&quot;$SPARK_DIST_CLASSPATH:/usr/lib/mahout/*&quot;</div></pre></td></tr></table></figure>
<p>然后，以本地模式在spark-shell中运行下面代码交互测试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//注意：这里是本地目录</div><div class="line">val model = new FileDataModel(new File(&quot;intro.csv&quot;))</div><div class="line"></div><div class="line">val evaluator = new RMSRecommenderEvaluator()</div><div class="line">val recommenderBuilder = new RecommenderBuilder &#123;</div><div class="line">  override def buildRecommender(dataModel: DataModel): Recommender = &#123;</div><div class="line">    val similarity = new LogLikelihoodSimilarity(dataModel)</div><div class="line">    new GenericItemBasedRecommender(dataModel, similarity)</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">val score = evaluator.evaluate(recommenderBuilder, null, model, 0.95, 0.05)</div><div class="line">println(s&quot;Score=$score&quot;)</div><div class="line"></div><div class="line">val recommender=recommenderBuilder.buildRecommender(model)</div><div class="line">val users=trainingRatings.map(_.user).distinct().take(20)</div><div class="line"></div><div class="line">import scala.collection.JavaConversions._</div><div class="line"></div><div class="line">val result=users.par.map&#123;user=&gt;</div><div class="line">  user+&quot;,&quot;+recommender.recommend(user,40).map(_.getItemID).mkString(&quot;,&quot;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="https://github.com/sujitpal/mia-scala-examples上面有一个评估基于物品或是用户的各种相似度下的评分的类，叫做" target="_blank" rel="external">https://github.com/sujitpal/mia-scala-examples上面有一个评估基于物品或是用户的各种相似度下的评分的类，叫做</a> RecommenderEvaluator，供大家学习参考。</p>
<h2 id="分布式运行"><a href="#分布式运行" class="headerlink" title="分布式运行"></a>分布式运行</h2><p>Mahout提供了<code>org.apache.mahout.cf.taste.hadoop.item.RecommenderJob</code>类以MapReduce的方式来实现基于物品的协同过滤，查看该类的使用说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">ubuntu@Master:~/data$ mahout org.apache.mahout.cf.taste.hadoop.item.RecommenderJob</div><div class="line">MAHOUT_LOCAL is not set; adding HADOOP_CONF_DIR to classpath.</div><div class="line">Running on hadoop, using /home/ubuntu/hadoop/bin/hadoop and HADOOP_CONF_DIR=/home/ubuntu/hadoop/etc/hadoop</div><div class="line">MAHOUT-JOB: /home/ubuntu/apache-mahout-distribution-0.10.1/mahout-examples-0.10.1-job.jar</div><div class="line">16/07/25 07:41:32 WARN driver.MahoutDriver: No org.apache.mahout.cf.taste.hadoop.item.RecommenderJob.props found on classpath, will use command-line arguments only</div><div class="line">16/07/25 07:41:33 ERROR common.AbstractJob: Missing required option --similarityClassname</div><div class="line">Missing required option --similarityClassname                                   </div><div class="line">Usage:                                                                          </div><div class="line"> [--input &lt;input&gt; --output &lt;output&gt; --numRecommendations &lt;numRecommendations&gt;   </div><div class="line">--usersFile &lt;usersFile&gt; --itemsFile &lt;itemsFile&gt; --filterFile &lt;filterFile&gt;       </div><div class="line">--userItemFile &lt;userItemFile&gt; --booleanData &lt;booleanData&gt; --maxPrefsPerUser     </div><div class="line">&lt;maxPrefsPerUser&gt; --minPrefsPerUser &lt;minPrefsPerUser&gt; --maxSimilaritiesPerItem  </div><div class="line">&lt;maxSimilaritiesPerItem&gt; --maxPrefsInItemSimilarity &lt;maxPrefsInItemSimilarity&gt;  </div><div class="line">--similarityClassname &lt;similarityClassname&gt; --threshold &lt;threshold&gt;             </div><div class="line">--outputPathForSimilarityMatrix &lt;outputPathForSimilarityMatrix&gt; --randomSeed    </div><div class="line">&lt;randomSeed&gt; --sequencefileOutput --help --tempDir &lt;tempDir&gt; --startPhase       </div><div class="line">&lt;startPhase&gt; --endPhase &lt;endPhase&gt;]                                             </div><div class="line">--similarityClassname (-s) similarityClassname    Name of distributed           </div><div class="line">                                                  similarity measures class to  </div><div class="line">                                                  instantiate, alternatively    </div><div class="line">                                                  use one of the predefined     </div><div class="line">                                                  similarities                  </div><div class="line">                                                  ([SIMILARITY_COOCCURRENCE,    </div><div class="line">                                                  SIMILARITY_LOGLIKELIHOOD,     </div><div class="line">                                                  SIMILARITY_TANIMOTO_COEFFICIEN</div><div class="line">                                                  T, SIMILARITY_CITY_BLOCK,     </div><div class="line">                                                  SIMILARITY_COSINE,            </div><div class="line">                                                  SIMILARITY_PEARSON_CORRELATION</div><div class="line">                                                  ,                             </div><div class="line">                                                  SIMILARITY_EUCLIDEAN_DISTANCE]</div><div class="line">                                                  )</div></pre></td></tr></table></figure>
<p>也可输入<code>mahout org.apache.mahout.cf.taste.hadoop.item.RecommenderJob  --help</code>查看详细说明</p>
<p>可见，该类可以接收的命令行参数如下：</p>
<p><code>--input(path)(-i)</code>: 存储用户偏好数据的目录，该目录下可以包含一个或多个存储用户偏好数据的文本文件；<br><code>--output(path)(-o)</code>: 结算结果的输出目录<br><code>--numRecommendations (integer)</code>: 为每个用户推荐的item数量，默认为10<br><code>--usersFile (path)</code>: 指定一个包含了一个或多个存储userID的文件路径，仅为该路径下所有文件包含的userID做推荐计算 (该选项可选)<br><code>--itemsFile (path)</code>: 指定一个包含了一个或多个存储itemID的文件路径，仅为该路径下所有文件包含的itemID做推荐计算 (该选项可选)<br><code>--filterFile (path)</code>: 指定一个路径，该路径下的文件包含了[userID,itemID]值对，userID和itemID用逗号分隔。计算结果将不会为user推荐[userID,itemID]值对中包含的item (该选项可选)<br><code>--booleanData (boolean)</code>: 如果输入数据不包含偏好数值，则将该参数设置为true，默认为false<br><code>--maxPrefsPerUser (integer)</code>: 在最后计算推荐结果的阶段，针对每一个user使用的偏好数据的最大数量，默认为10<br><code>--minPrefsPerUser (integer)</code>: 在相似度计算中，忽略所有偏好数据量少于该值的用户，默认为1<br><code>--maxSimilaritiesPerItem (integer)</code>: 针对每个item的相似度最大值，默认为100<br><code>--maxPrefsPerUserInItemSimilarity (integer)</code>: 在item相似度计算阶段，针对每个用户考虑的偏好数据最大数量，默认为1000<br><code>--similarityClassname (classname)</code>: 向量相似度计算类<br><code>outputPathForSimilarityMatrix</code>：SimilarityMatrix输出目录<br><code>--randomSeed</code>：随机种子 –sequencefileOutput：序列文件输出路径<br><code>--tempDir (path)</code>: 存储临时文件的目录，默认为当前用户的home目录下的temp目录<br><code>--startPhase</code><br><code>--endPhase</code><br><code>--threshold (double)</code>: 忽略相似度低于该阀值的item对</p>
<p>一个例子如下，使用<code>SIMILARITY_LOGLIKELIHOOD</code>相似度推荐物品：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hadoop jar /usr/lib/mahout/mahout-examples-0.9-cdh5.4.0-job.jar org.apache.mahout.cf.taste.hadoop.item.RecommenderJob --input /tmp/mahout/part-00000 --output /tmp/mahout-out  -s SIMILARITY_LOGLIKELIHOOD</div></pre></td></tr></table></figure></p>
<p>自己运行的例子如下：</p>
<p>部分实验数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">1	25	0.0136316222</div><div class="line">1	116	0.0090877481</div><div class="line">1	5	0.0045438741</div><div class="line">1	23	0.1862988368</div><div class="line">1	17	0.0272632444</div><div class="line">1	3	1.4122360602</div><div class="line">1	11	0.0363509925</div><div class="line">1	12	0.4543874068</div><div class="line">1	120	0.0027263244</div><div class="line">1	93	0.0136316222</div><div class="line">1	21	0.0036350993</div><div class="line">1	6	0.7688234922</div><div class="line">1	47	0.0018175496</div><div class="line">1	66	0.0454387407</div><div class="line">1	27	0.0254456948</div><div class="line">1	44	0.0245369200</div><div class="line">1	315	0.0045438741</div><div class="line">1	28	0.0545264888</div><div class="line">1	138	0.0636142369</div><div class="line">1	108	0.0045438741</div><div class="line">1	1	7.2695320732</div><div class="line">1	85	12.5188577359</div><div class="line">1	168	0.0545264888</div><div class="line">10	4	0.6772009029</div><div class="line">10	6	0.6772009029</div><div class="line">10	217	0.0112866817</div><div class="line">10	2	1.7607223476</div><div class="line">10	1	1.8735891648</div><div class="line">100	25	0.4788867023</div><div class="line">100	5	0.0047793084</div><div class="line">100	17	0.2915378128</div><div class="line">100	26	0.0047793084</div><div class="line">100	3	0.1194827101</div><div class="line">100	11	0.6987348890</div><div class="line">100	4	0.6652797301</div><div class="line">100	12	0.0047793084</div><div class="line">100	30	0.0736013495</div><div class="line">100	32	0.5257239247</div><div class="line">100	31	0.0076468934</div><div class="line">100	37	0.0430137757</div><div class="line">100	29	0.0592634242</div><div class="line">100	44	0.0009558617</div><div class="line">100	13	4.4313747540</div><div class="line">100	1	9.5461906101</div><div class="line">100	10	0.0439696373</div><div class="line">1000	8	0.2902055623</div><div class="line">1000	14	0.0483675937</div><div class="line">1000	5	0.0725513906</div><div class="line">1000	9	0.0725513906</div><div class="line">1000	26	0.3869407497</div><div class="line">1000	3	0.1451027811</div><div class="line">1000	436	0.0120918984</div><div class="line">1000	2	3.9177750907</div><div class="line">1000	15	2.4304715840</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ubuntu@Master:~/data$ mahout org.apache.mahout.cf.taste.hadoop.item.RecommenderJob -i /test/item/ckm_pre_result1000000.txt -o /test/item/outputPersonCorr --similarityClassname org.apache.mahout.math.hadoop.similarity.cooccurrence.measures.PearsonCorrelationSimilarity</div></pre></td></tr></table></figure>
<p>部分结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1	[196:10.482155,14:9.271373,145:8.875873,177:7.779633,360:7.537198,114:7.1917353,635:7.085346,75:6.8879533,235:6.796164,210:6.586777]</div><div class="line">2	[386:4.339762,631:4.2806735,194:4.274664,153:4.1018524,362:3.7975848,934:3.422003,195:3.0110214,188:2.7676048,30:2.6990044,746:2.693153]</div><div class="line">3	[45:4.2422075,212:4.1731844,270:3.9618893,309:3.960001,204:3.933118,275:3.6498196,321:3.6286862,179:3.487534,240:3.3450491,170:3.28568]</div><div class="line">4	[293:4.3900704,746:3.9469879,51:3.3795352,52:3.3444872,312:2.818981,24:2.719058,649:2.2690945,28:2.1947412,196:2.170363,145:2.008545]</div><div class="line">5	[590:1.1531421,332:1.1508745,336:1.134177,852:1.1335075,561:1.121143,36:1.1099223,535:1.0878772,129:1.0850264,236:1.0413511,83:1.0349866]</div></pre></td></tr></table></figure></p>
<p>默认情况下，mahout使用的reduce数目为1，这样造成大数据处理时效率较低，可以通过参数mahout执行脚本中的<code>MAHOUT_OPTS</code>中的<code>-Dmapred.reduce.tasks</code>参数指定reduce数目。</p>
<p>上面命令运行完成之后，会在当前用户的hdfs主目录生成temp目录，该目录可由–tempDir (path)参数设置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ hadoop fs -ls temp</div><div class="line">Found 10 items</div><div class="line">-rw-r--r--   3 root hadoop          7 2015-06-10 14:42 temp/maxValues.bin</div><div class="line">-rw-r--r--   3 root hadoop    5522717 2015-06-10 14:42 temp/norms.bin</div><div class="line">drwxr-xr-x   - root hadoop          0 2015-06-10 14:41 temp/notUsed</div><div class="line">-rw-r--r--   3 root hadoop          7 2015-06-10 14:42 temp/numNonZeroEntries.bin</div><div class="line">-rw-r--r--   3 root hadoop    3452222 2015-06-10 14:41 temp/observationsPerColumn.bin</div><div class="line">drwxr-xr-x   - root hadoop          0 2015-06-10 14:47 temp/pairwiseSimilarity</div><div class="line">drwxr-xr-x   - root hadoop          0 2015-06-10 14:52 temp/partialMultiply</div><div class="line">drwxr-xr-x   - root hadoop          0 2015-06-10 14:39 temp/preparePreferenceMatrix</div><div class="line">drwxr-xr-x   - root hadoop          0 2015-06-10 14:50 temp/similarityMatrix</div><div class="line">drwxr-xr-x   - root hadoop          0 2015-06-10 14:42 temp/weights</div></pre></td></tr></table></figure>
<p>观察yarn的管理界面，该命令会生成9个任务，任务名称依次是：</p>
<ul>
<li>PreparePreferenceMatrixJob-ItemIDIndexMapper-Reducer</li>
<li>PreparePreferenceMatrixJob-ToItemPrefsMapper-Reducer</li>
<li>PreparePreferenceMatrixJob-ToItemVectorsMapper-Reducer</li>
<li>RowSimilarityJob-CountObservationsMapper-Reducer</li>
<li>RowSimilarityJob-VectorNormMapper-Reducer</li>
<li>RowSimilarityJob-CooccurrencesMapper-Reducer</li>
<li>RowSimilarityJob-UnsymmetrifyMapper-Reducer</li>
<li>partialMultiply</li>
<li>RecommenderJob-PartialMultiplyMapper-Reducer</li>
</ul>
<p>从任务名称，大概可以知道每个任务在做什么，如果你的输入参数不一样，生成的任务数可能不一样，这个需要测试一下才能确认。</p>
<p>在hdfs上查看输出的结果，用户和推荐结果用\t分隔，推荐结果中物品之间用逗号分隔，物品后面通过冒号连接评分：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">843 [10709679:4.8334665,8389878:4.833426,9133835:4.7503786,10366169:4.7503185,9007487:4.750272,8149253:4.7501993,10366165:4.750115,9780049:4.750108,8581254:4.750071,10456307:4.7500467]</div><div class="line">6253    [10117445:3.0375953,10340299:3.0340924,8321090:3.0340924,10086615:3.032164,10436801:3.0187714,9668385:3.0141575,8502110:3.013954,10476325:3.0074399,10318667:3.0004222,8320987:3.0003839]</div></pre></td></tr></table></figure></p>
<p>使用Java API方式执行，请参考<a href="http://blog.fens.me/hadoop-mahout-mapreduce-itemcf/" target="_blank" rel="external">Mahout分步式程序开发 基于物品的协同过滤ItemCF</a>。</p>
<p>在Scala或者Spark中，可以以Java API或者命令方式运行，最后还可以通过Spark来处理推荐的结果，例如：过滤、去重、补足数据，这部分内容不做介绍。</p>
<p>本文基本转载自：转载自<a href="http://blog.javachen.com/" target="_blank" rel="external">JavaChen Blog</a>，作者：JavaChen，文章地址<a href="http://blog.javachen.com/2015/06/10/collaborative-filtering-using-mahout.html" target="_blank" rel="external">http://blog.javachen.com/2015/06/10/collaborative-filtering-using-mahout.html</a></p>
<p>其他参考资料:</p>
<ul>
<li><a href="http://blog.fens.me/hadoop-mapreduce-recommend/" target="_blank" rel="external">用Hadoop构建电影推荐系统(自己实现分布式)</a></li>
<li><a href="http://blog.fens.me/hadoop-mahout-recommend-job/" target="_blank" rel="external">用Mahout构建职位推荐引擎(单机)</a></li>
<li><a href="http://blog.fens.me/hadoop-mahout-recommend-book/" target="_blank" rel="external">Mahout构建图书推荐系统(单机)</a></li>
<li><a href="http://blog.fens.me/hadoop-mahout-mapreduce-itemcf/" target="_blank" rel="external">Mahout分步式程序开发 基于物品的协同过滤ItemCF（调用接口）</a></li>
<li><a href="http://www.chinahadoop.cn/group/5/thread/499" target="_blank" rel="external">mahout分布式：Item-based推荐</a></li>
<li><a href="https://mahout.apache.org/users/recommender/intro-itembased-hadoop.html" target="_blank" rel="external">Introduction to Item-Based Recommendations with Hadoop</a></li>
<li><a href="http://my.oschina.net/Cfreedom/blog/201828" target="_blank" rel="external">使用Mahout搭建推荐系统之入门篇4-Mahout实战</a></li>
<li><a href="http://zengzhaozheng.blog.51cto.com/8219051/1557054" target="_blank" rel="external">基于MapReduce的ItemBase推荐算法的共现矩阵实现</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="Skye" />
          <p class="site-author-name" itemprop="name">Skye</p>
          <p class="site-description motion-element" itemprop="description">学习总结 思想感悟</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">56</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/1811544100" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/Skyexu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Skye</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"skyexu"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("p2QERxuUt7diC0fdFhjqrKby-gzGzoHsz", "L1rxwRUiV2suWuAJN976CvgG");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
